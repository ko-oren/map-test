<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Map Editor</title>
  <script src="https://cdn.jsdelivr.net/npm/markerjs@2/dist/markerjs.min.js"></script>
</head>
<body>

<h2>Map Editor (private)</h2>
<p>Click “Edit markers” to modify the map.</p>

<img id="mapImage" src="map.png" style="max-width:100%;">
<br><br>
<button id="edit">Edit markers</button>
<button id="save">Save markers</button>

<script>
// Use global markerjs3 object
const { MarkerArea, ArrowMarker, MarkerView, Renderer } = markerjs3;

// create the target image element
const targetImg = document.createElement('img');
targetImg.src = 'map.png';

// app div
const app = document.querySelector('#app');

// create the marker area, assign the target image and append it to the app div
const markerArea = new MarkerArea();
markerArea.targetImage = targetImg;
app.appendChild(markerArea);

// add arrow marker button action
document.querySelector('#addArrowButton').addEventListener('click', () => {
  markerArea.createMarker(ArrowMarker);
});

// add annotation viewer and hide it initially
const markerView = new MarkerView();
markerView.targetImage = targetImg;
app.appendChild(markerView);
markerView.style.display = 'none';

// add save button action
document.querySelector('#saveButton').addEventListener('click', () => {
  // get marker area state (annotation)
  const state = markerArea.getState();

  // display the state in the viewer
  markerView.style.display = '';
  markerView.show(state);

  // render the annotation to an image
  const renderer = new Renderer();
  renderer.targetImage = targetImg;
  renderer.rasterize(state).then((dataUrl) => {
    rasterImage.src = dataUrl;
    rasterImage.style.display = '';
  });
});

// image element for the rendered annotation
const rasterImage = document.createElement('img');
app.appendChild(rasterImage);
rasterImage.style.display = 'none';
</script>

</body>
</html>
