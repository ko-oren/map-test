<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/@markerjs/markerjs3/umd/markerjs3.js"></script>
    <link rel="stylesheet" href="./style.css" />
    <title>marker.js 3 JavaScript Quick Start</title>
  </head>
  <body>
    <div id="app">
      <button id="addArrowButton">Add Arrow</button>
      <button id="saveButton">Save</button>
    </div>
    <script type="module" src="./main.js"></script>
  </body>
</html>

<script>
// Use global markerjs3 object
const { MarkerArea, ArrowMarker, MarkerView, Renderer } = markerjs3;

// create the target image element
const targetImg = document.createElement('img');
targetImg.src = 'map.png';

// app div
const app = document.querySelector('#app');

// create the marker area, assign the target image and append it to the app div
const markerArea = new MarkerArea();
markerArea.targetImage = targetImg;
app.appendChild(markerArea);

// add arrow marker button action
document.querySelector('#addArrowButton').addEventListener('click', () => {
  markerArea.createMarker(ArrowMarker);
});

// add annotation viewer and hide it initially
const markerView = new MarkerView();
markerView.targetImage = targetImg;
app.appendChild(markerView);
markerView.style.display = 'none';

// add save button action
document.querySelector('#saveButton').addEventListener('click', () => {
  // get marker area state (annotation)
  const state = markerArea.getState();

  // display the state in the viewer
  markerView.style.display = '';
  markerView.show(state);

  // render the annotation to an image
  const renderer = new Renderer();
  renderer.targetImage = targetImg;
  renderer.rasterize(state).then((dataUrl) => {
    rasterImage.src = dataUrl;
    rasterImage.style.display = '';
  });
});

// image element for the rendered annotation
const rasterImage = document.createElement('img');
app.appendChild(rasterImage);
rasterImage.style.display = 'none';
</script>

</body>
</html>
